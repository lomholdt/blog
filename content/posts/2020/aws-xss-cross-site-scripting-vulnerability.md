---
title: "Blast from the past: Cross Site Scripting on the AWS Console. Amazon Bug Bounties, but not for AWS."
date: 2020-07-01T10:00:39-07:00
draft: true
tags: [
        "bug bounty",
        "story"
    ]
---

## Amazon Bug Bounty!

**Great news:** Amazon is offering bounties via a [security vulnerabiltiy research program](https://hackerone.com/amazonvrp)

**Bad news:** AWS is out of scope!

When I read this I remembered that a few years ago I found persistent Cross-Site-Scripting on the AWS Console web application. Going through my notes from back then I found details and screenshots (also a video) about it. This seems like a proper time to share that story from the past, the techniques I used and how they evolved over the years.

## AWS Console and Cross Site Scripting 

The story is that I had just created an AWS account and started using the service. I wanted to start using EC2 for some projects, in particular I had just created the game [Wonder Witches](https://wunderwuzzi.net/wonderwitches) and was looking for a place to host a website for it.

At that time I was not looking for security vulnerabilities per se, just trying to understand the AWS offerings better. 

One of my basic habits however is that whenever I create items or objects in systems I check if there are basic parsing issues. 

This is sort of **feeling the temperature of the patient that I'm dealing with** so to speak. Its a basic evaluation of most things I use on the web. 

For instance, I would create new items with names such as:

```
Johann"/><h1>hello</h1>
```

### What does this do?

1. `Johann` is just  the regular string I want to use
2.  `"/>` is closing a possible HTML element tag (this is basically probing for an injection)
3.  `<h1>hello</h1>` is the injected payload which does not do anything malicous it just prints hello in large font

This is a basic test to evaluate if there is an HTML element injection. Surprisingly, this is not uncommon and if present can typically be escalated to get `Cross Site Scripting` going. 

### Creating EC2 instances and metadata tags

As you can guess I did just that with the `AWS Console` when creating a new EC2 instance. I was creating `tags` for the EC2 instance and named a `tag` the following:

```
Apache"/><h1>Web Server</h1>
```

This was a good (bad) choice as it turned out. The results was that next time I rendered the page (and on other pages as well) I got the following:

[![EC2 Instance Tag HTML Injection](/blog/images/2020/awsxss/aws-xss-tag1.png)](/blog/images/2020/awsxss/aws-xss-tag1.png)

When I saw this I immediately knew that there is a persistent XSS that allows elevation of privilege to steal cookies or perform CSRF attacks on other users. To demonstrate this I injected a basic Javascript XSS pop-up message showing the domain that an adversary can run code on when exploiting this XSS vulnerability:

[![EC2 Instance Tag HTML Injection](/blog/images/2020/awsxss/aws-xss-tag2.png)](/blog/images/2020/awsxss/aws-xss-tag2.png)

Looking at the actual DOM of the HTML page we can see that the following had happened:

[![EC2 Instance Tag HTML Injection](/blog/images/2020/awsxss/aws-xss-dom.png)](/blog/images/2020/awsxss/aws-xss-dom.png)

At that point I realized that it **allows a lower privileged user in an AWS account to elevate to admin** (in case an admin ever visits or explores the metadata - which is not unlikely).

Intersting note, the AWS Console form a few years ago basically still looks  similar to the one from today!

### Amazon's Response

I reported this to AWS and the fixed it within a few days! 

Amazon offered a free ticket for re:Invent. I just realized that I never got to go to re:Invent though :( --- I totally forgot to follow up with Amazon about that back in the day... The responsible disclosure is not mentioned on [Amazon's Security Bulletins page](https://aws.amazon.com/security/security-bulletins). 
    
However, I remember being quite happy to help Amazon make AWS more secure. :) It's a great product.

## More advanced test cases

Times evolve and new technologies emerge, and with them variations of vulnerabilities appear.  Hence my basic `test string` also changed over the years. Here is a string that I still commonly use whenever I signup for a new service or product to see if there is any low hanging fruit:

```
Hello'{{5*5}}"/><img src=: onerror=alert(document.domain)>
```

### Explanation

It's checking for:

1. SQL Injection ==> `'"` might throw a syntax error
2. HTML Template Injection ==>  `{{5*5}}` if a rendered page ever displays `25`, there is an injection issue
3. HTML Element Injection ==>  A basic Cross Site Scripting (XSS) test, which would display a pop-up message showing the `domain` which we execute code on 

I'm certain five years from now that test string will look again slightly different. 

## That's it.

Hope you enjoyed reading this story from the past. If you liked the post, or have a question reach out on Twitter: [@wunderwuzzi23](https://twitter.com/wunderwuzzi23)